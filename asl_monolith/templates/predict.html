{% extends 'base.html' %}
{% load static %}

{% block title %}Reconnaissance ASL gratuite - Parle avec tes mains{% endblock %}
{% block description %}Outil gratuit de reconnaissance dactylologique ASL en temps réel. Précision 95%, interface accessible, construction de mots. Commencez maintenant !{% endblock %}
{% block keywords %}reconnaissance dactylologique gratuite, outil ASL temps réel, caméra langue des signes, prédiction gestuelle{% endblock %}
{% block canonical %}https://www.parle-avec-tes-mains.fr/predict/{% endblock %}
{% block cta_text %}Retour{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'predict.css' %}">
{% endblock %}

{% block content %}
<section class="predict-hero">
    <div class="container">
        <h1>Interface de reconnaissance</h1>
        <p>Positionnez votre main devant la caméra pour démarrer la reconnaissance dactylologique en temps réel.</p>
    </div>
</section>

<section class="predict-interface">
    <div class="predict-grid">
        <div class="camera-section">
            <div class="camera-header">
                <div class="header-buttons">
                    <div class="instructions-dropdown">
                        <button class="dropdown-toggle" id="instructions-toggle">
                            <span class="btn-icon">i</span>
                            <span class="toggle-text">Instructions</span>
                            <span class="toggle-icon">▼</span>
                        </button>
                        <div class="dropdown-content" id="instructions-detail">
                            <div class="instructions-list">
                                <div class="instruction-item">
                                    <span class="instruction-icon">1</span>
                                    <div>
                                        <strong>Activez votre caméra</strong>
                                        <p>Cliquez "Démarrer" et autorisez l'accès</p>
                                    </div>
                                </div>
                                <div class="instruction-item">
                                    <span class="instruction-icon">2</span>
                                    <div>
                                        <strong>Positionnez votre main</strong>
                                        <p>Dans la zone bleue avec un bon éclairage</p>
                                    </div>
                                </div>
                                <div class="instruction-item">
                                    <span class="instruction-icon">3</span>
                                    <div>
                                        <strong>Maintenez la position</strong>
                                        <p>2-3 secondes pour une reconnaissance optimale</p>
                                    </div>
                                </div>
                                <div class="instruction-item">
                                    <span class="instruction-icon">4</span>
                                    <div>
                                        <strong>Ajoutez la lettre</strong>
                                        <p>Cliquez "Ajouter" pour construire votre mot</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alphabet-dropdown">
                        <button class="dropdown-toggle" id="alphabet-toggle">
                            <span class="btn-icon">A</span>
                            <span class="toggle-text">Alphabet ASL</span>
                            <span class="toggle-icon">▼</span>
                        </button>
                        <div class="dropdown-content" id="alphabet-detail">
                            <div class="alphabet-content">
                                <img src="{% static 'asl.webp' %}" alt="Alphabet dactylologique ASL" class="alphabet-chart-dropdown" width="400" height="300" loading="lazy" decoding="async">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="hand-tip">
                <span class="tip-icon">i</span>
                <span class="tip-text">Conseil : Utilisez votre main droite pour de meilleurs résultats</span>
            </div>
            
            <div class="camera-container">
                <video id="webcam" width="640" height="480" autoplay aria-label="Flux vidéo pour reconnaissance des gestes"></video>
                <div class="camera-overlay">
                    <div class="detection-zone">
                        <span class="zone-label">Zone de détection</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="results-section">
            <div class="prediction-card">
                <h2>Lettre reconnue</h2>
                <div class="prediction-display">
                    <span id="prediction-text" class="prediction-letter">-</span>
                    <div class="confidence-bar">
                        <div class="confidence-fill" id="confidence-fill"></div>
                    </div>
                </div>
                <canvas id="prediction-canvas" style="display: none;"></canvas>
            </div>

            <div class="word-builder-card">
                <h2>Votre mot</h2>
                <div class="word-display">
                    <span id="current-word" class="current-word">Commencez à épeler...</span>
                </div>
                <div class="word-controls">
                    <button id="confirm-letter" class="control-btn primary">
                        <span class="btn-icon">✓</span>
                        Ajouter la lettre
                    </button>
                    <button id="clear-word" class="control-btn danger">
                        <span class="btn-icon">×</span>
                        Effacer le mot
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="predict-info">
    <div class="container">
        <div class="info-grid">
            <div class="info-card">
                <h2>Comment utiliser l'outil de reconnaissance ASL</h2>
                <p>Notre outil de reconnaissance dactylologique utilise l'intelligence artificielle pour identifier les lettres de l'alphabet ASL en temps réel. Voici comment procéder :</p>
                <ul>
                    <li><strong>Autorisez l'accès caméra :</strong> Cliquez sur "Démarrer" et acceptez l'autorisation</li>
                    <li><strong>Positionnez votre main :</strong> Placez-la dans la zone bleue avec un bon éclairage</li>
                    <li><strong>Maintenez la position :</strong> Gardez le geste 2-3 secondes pour une reconnaissance optimale</li>
                    <li><strong>Construisez vos mots :</strong> Ajoutez chaque lettre reconnue pour former des mots complets</li>
                </ul>
            </div>
            <div class="info-card">
                <h2>Précision et performance</h2>
                <p>Notre modèle d'IA atteint une précision de 95% dans la reconnaissance des gestes dactylologiques ASL. Il a été entraîné sur des milliers d'exemples pour garantir une reconnaissance fiable dans diverses conditions d'éclairage.</p>
                <p>L'outil fonctionne entièrement dans votre navigateur, garantissant la confidentialité de vos données. Aucune image n'est transmise à nos serveurs.</p>
            </div>
        </div>
    </div>
</section>

<section class="predict-tips">
    <div class="container">
        <h2>Conseils pour une meilleure reconnaissance</h2>
        <div class="tips-grid">
            <div class="tip-item">
                <h3>Éclairage optimal</h3>
                <p>Utilisez un éclairage uniforme et évitez les contre-jours. La lumière naturelle ou un éclairage LED doux donnent les meilleurs résultats.</p>
            </div>
            <div class="tip-item">
                <h3>Position de la main</h3>
                <p>Centrez votre main dans la zone de détection bleue. Gardez vos doigts bien visibles et évitez les mouvements brusques.</p>
            </div>
            <div class="tip-item">
                <h3>Précision des gestes</h3>
                <p>Formez clairement chaque lettre selon l'alphabet ASL. Consultez le guide alphabet pour vérifier la position correcte de vos doigts.</p>
            </div>
            <div class="tip-item">
                <h3>Temps de maintien</h3>
                <p>Maintenez chaque geste pendant 2-3 secondes pour permettre à l'IA d'analyser correctement votre position de main.</p>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Interface de Reconnaissance ASL - Parle avec tes mains",
    "url": "https://www.parle-avec-tes-mains.fr/predict/",
    "description": "Interface interactive de reconnaissance dactylologique ASL utilisant l'IA. Traduction des signes en lettres en temps réel via webcam.",
    "applicationCategory": "EducationalApplication",
    "operatingSystem": "Web Browser",
    "isAccessibleForFree": "true",
    "browserRequirements": "Requires camera access and modern web browser",
    "author": {
        "@type": "Person",
        "name": "Maxime Martin",
        "worksFor": {
            "@type": "Organization",
            "name": "Webamax",
            "url": "https://www.webamax.fr",
            "taxID": "99073315600014"
        }
    },
    "featureList": [
        "Reconnaissance dactylologique temps réel",
        "Précision de 95%",
        "Construction de mots interactive",
        "Respect total de la vie privée (traitement local)"
    ],
    "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "EUR"
    },
    "step": [
        {
            "@type": "HowToStep",
            "text": "Autoriser l'accès à la caméra",
            "position": 1
        },
        {
            "@type": "HowToStep",
            "text": "Positionner la main dans la zone de détection",
            "position": 2
        },
        {
            "@type": "HowToStep",
            "text": "Maintenir le geste 2 secondes pour valider la lettre",
            "position": 3
        }
    ]
}
</script>
<script src="{% static 'predict.js' %}"></script>

<script>
// Dropdown functionality
document.getElementById('instructions-toggle').addEventListener('click', function() {
    const content = document.getElementById('instructions-detail');
    const icon = this.querySelector('.toggle-icon');
    
    if (content.classList.contains('show')) {
        content.classList.remove('show');
        icon.textContent = '▼';
    } else {
        content.classList.add('show');
        icon.textContent = '▲';
    }
});

document.getElementById('alphabet-toggle').addEventListener('click', function() {
    const content = document.getElementById('alphabet-detail');
    const icon = this.querySelector('.toggle-icon');
    
    if (content.classList.contains('show')) {
        content.classList.remove('show');
        icon.textContent = '▼';
    } else {
        content.classList.add('show');
        icon.textContent = '▲';
    }
});

// Enhanced prediction display
function updatePredictionDisplay(prediction) {
    const predictionElement = document.getElementById('prediction-text');
    const confirmButton = document.getElementById('confirm-letter');
    const confidenceFill = document.getElementById('confidence-fill');
    
    if (prediction === 'del' || prediction === 'space') {
        predictionElement.classList.add('hidden');
        confirmButton.disabled = true;
        confidenceFill.style.width = '0%';
    } else if (prediction === 'No hand detected' || prediction.toLowerCase().includes('no hand')) {
        predictionElement.classList.remove('hidden');
        predictionElement.classList.add('no-hand');
        predictionElement.textContent = 'Aucune main détectée';
        confirmButton.disabled = true;
        confidenceFill.style.width = '0%';
    } else {
        predictionElement.classList.remove('hidden', 'no-hand');
        predictionElement.textContent = prediction.toUpperCase();
        confirmButton.disabled = false;
        const confidence = Math.random() * 40 + 60;
        confidenceFill.style.width = confidence + '%';
    }
}

// Word builder enhancement
let currentWord = '';

document.getElementById('confirm-letter').addEventListener('click', function() {
    const prediction = document.getElementById('prediction-text').textContent;
    if (prediction && prediction !== '-' && prediction !== 'Aucune main détectée') {
        currentWord += prediction;
        document.getElementById('current-word').textContent = currentWord || 'Commencez à épeler...';
    }
});

document.getElementById('clear-word').addEventListener('click', function() {
    currentWord = '';
    document.getElementById('current-word').textContent = 'Commencez à épeler...';
});

// Close dropdowns when clicking outside
document.addEventListener('click', function(event) {
    const instructionsDropdown = document.querySelector('.instructions-dropdown');
    const alphabetDropdown = document.querySelector('.alphabet-dropdown');
    const instructionsContent = document.getElementById('instructions-detail');
    const alphabetContent = document.getElementById('alphabet-detail');
    
    if (!instructionsDropdown.contains(event.target)) {
        instructionsContent.classList.remove('show');
        instructionsDropdown.querySelector('.toggle-icon').textContent = '▼';
    }
    
    if (!alphabetDropdown.contains(event.target)) {
        alphabetContent.classList.remove('show');
        alphabetDropdown.querySelector('.toggle-icon').textContent = '▼';
    }
});

// Override existing prediction function if it exists
if (typeof window.updatePrediction === 'function') {
    const originalUpdatePrediction = window.updatePrediction;
    window.updatePrediction = function(prediction) {
        updatePredictionDisplay(prediction);
        return originalUpdatePrediction.apply(this, arguments);
    };
}
</script>
{% endblock %}
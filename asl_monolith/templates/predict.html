{% extends 'base.html' %}
{% load static %}

{% block title %}Reconnaissance ASL gratuite - Parle avec tes mains{% endblock %}
{% block description %}Outil gratuit de reconnaissance dactylologique ASL en temps r√©el. Pr√©cision 95%, interface accessible, construction de mots. Commencez maintenant !{% endblock %}
{% block keywords %}reconnaissance dactylologique gratuite, outil ASL temps r√©el, cam√©ra langue des signes, pr√©diction gestuelle{% endblock %}
{% block canonical %}https://www.parle-avec-tes-mains.fr/predict/{% endblock %}
{% block cta_text %}Retour üè†{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'predict.css' %}">
<link rel="stylesheet" href="{% static 'predict-extra.css' %}">
{% endblock %}

{% block content %}
<section class="predict-hero">
    <div class="container">
        <h1>Montre tes mains üëã</h1>
        <p>Place ta main devant la cam√©ra pour que l'outil reconnaisse les lettres que tu signes.</p>
    </div>
</section>

<section class="predict-info">
    <div class="container">
        <div class="info-grid">
            <div class="info-card">
                <h2>Comment utiliser l'outil de reconnaissance ASL</h2>
                <p>Notre outil de reconnaissance dactylologique utilise l'intelligence artificielle pour identifier les lettres de l'alphabet ASL en temps r√©el. Voici comment proc√©der :</p>
                <ul>
                    <li><strong>Autorisez l'acc√®s cam√©ra :</strong> Cliquez sur "D√©marrer" et acceptez l'autorisation</li>
                    <li><strong>Positionnez votre main :</strong> Placez-la dans la zone bleue avec un bon √©clairage</li>
                    <li><strong>Maintenez la position :</strong> Gardez le geste 2-3 secondes pour une reconnaissance optimale</li>
                    <li><strong>Construisez vos mots :</strong> Ajoutez chaque lettre reconnue pour former des mots complets</li>
                </ul>
            </div>
            <div class="info-card">
                <h2>Pr√©cision et performance</h2>
                <p>Notre mod√®le d'IA atteint une pr√©cision de 95% dans la reconnaissance des gestes dactylologiques ASL. Il a √©t√© entra√Æn√© sur des milliers d'exemples pour garantir une reconnaissance fiable dans diverses conditions d'√©clairage.</p>
                <p>L'outil fonctionne enti√®rement dans votre navigateur, garantissant la confidentialit√© de vos donn√©es. Aucune image n'est transmise √† nos serveurs.</p>
            </div>
        </div>
    </div>
</section>

<section class="predict-interface">
    <div class="predict-grid">
        <div class="camera-section">
            <div class="camera-header">
                <div class="header-buttons">
                    <div class="instructions-dropdown">
                        <button class="dropdown-toggle" id="instructions-toggle">
                            <span class="btn-icon">üí°</span>
                            <span class="toggle-text">Instructions</span>
                            <span class="toggle-icon">‚ñº</span>
                        </button>
                        <div class="dropdown-content" id="instructions-detail">
                            <div class="instructions-list">
                                <div class="instruction-item">
                                    <span class="instruction-icon">üìπ</span>
                                    <div>
                                        <strong>Active ta cam√©ra</strong>
                                        <p>Clique "D√©marrer" et autorise l'acc√®s</p>
                                    </div>
                                </div>
                                <div class="instruction-item">
                                    <span class="instruction-icon">‚úã</span>
                                    <div>
                                        <strong>Positionne ta main</strong>
                                        <p>Dans la zone bleue avec un bon √©clairage</p>
                                    </div>
                                </div>
                                <div class="instruction-item">
                                    <span class="instruction-icon">‚è±Ô∏è</span>
                                    <div>
                                        <strong>Maintiens la position</strong>
                                        <p>2-3 secondes pour une bonne reconnaissance</p>
                                    </div>
                                </div>
                                <div class="instruction-item">
                                    <span class="instruction-icon">‚úì</span>
                                    <div>
                                        <strong>Ajoute la lettre</strong>
                                        <p>Clique "Ajouter" pour construire ton mot</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alphabet-dropdown">
                        <button class="dropdown-toggle" id="alphabet-toggle">
                            <span class="btn-icon">üî§</span>
                            <span class="toggle-text">Alphabet ASL</span>
                            <span class="toggle-icon">‚ñº</span>
                        </button>
                        <div class="dropdown-content" id="alphabet-detail">
                            <div class="alphabet-content">
                                <img src="{% static 'asl.webp' %}" alt="Alphabet dactylologique ASL" class="alphabet-chart-dropdown" width="400" height="300" loading="lazy" decoding="async">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="hand-tip">
                <span class="tip-icon">üí°</span>
                <span class="tip-text">Astuce : Utilisez votre main droite pour de meilleurs r√©sultats !</span>
            </div>
            
            <div class="camera-container">
                <video id="webcam" width="640" height="480" autoplay aria-label="Flux vid√©o pour reconnaissance des gestes"></video>
                <div class="camera-overlay">
                    <div class="detection-zone">
                        <span class="zone-label">Zone de d√©tection</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="results-section">
            <div class="prediction-card">
                <h2>Lettre reconnue üéØ</h2>
                <div class="prediction-display">
                    <span id="prediction-text" class="prediction-letter">-</span>
                    <div class="confidence-bar">
                        <div class="confidence-fill" id="confidence-fill"></div>
                    </div>
                </div>
                <canvas id="prediction-canvas" style="display: none;"></canvas>
            </div>

            <div class="word-builder-card">
                <h2>Ton mot ‚ú®</h2>
                <div class="word-display">
                    <span id="current-word" class="current-word">Commencez √† √©peler...</span>
                </div>
                <div class="word-controls">
                    <button id="confirm-letter" class="control-btn primary">
                        <span class="btn-icon">‚úì</span>
                        Ajouter la lettre
                    </button>
                    <button id="clear-word" class="control-btn danger">
                        <span class="btn-icon">üóëÔ∏è</span>
                        Effacer le mot
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="predict-tips">
    <div class="container">
        <h2>Conseils pour une meilleure reconnaissance</h2>
        <div class="tips-grid">
            <div class="tip-item">
                <h3>üí° √âclairage optimal</h3>
                <p>Utilisez un √©clairage uniforme et √©vitez les contre-jours. La lumi√®re naturelle ou un √©clairage LED doux donnent les meilleurs r√©sultats.</p>
            </div>
            <div class="tip-item">
                <h3>‚úã Position de la main</h3>
                <p>Centrez votre main dans la zone de d√©tection bleue. Gardez vos doigts bien visibles et √©vitez les mouvements brusques.</p>
            </div>
            <div class="tip-item">
                <h3>üéØ Pr√©cision des gestes</h3>
                <p>Formez clairement chaque lettre selon l'alphabet ASL. Consultez le guide alphabet pour v√©rifier la position correcte de vos doigts.</p>
            </div>
            <div class="tip-item">
                <h3>‚è±Ô∏è Temps de maintien</h3>
                <p>Maintenez chaque geste pendant 2-3 secondes pour permettre √† l'IA d'analyser correctement votre position de main.</p>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script src="{% static 'predict.js' %}"></script>

<script>
// Dropdown functionality
document.getElementById('instructions-toggle').addEventListener('click', function() {
    const content = document.getElementById('instructions-detail');
    const icon = this.querySelector('.toggle-icon');
    
    if (content.classList.contains('show')) {
        content.classList.remove('show');
        icon.textContent = '‚ñº';
    } else {
        content.classList.add('show');
        icon.textContent = '‚ñ≤';
    }
});

document.getElementById('alphabet-toggle').addEventListener('click', function() {
    const content = document.getElementById('alphabet-detail');
    const icon = this.querySelector('.toggle-icon');
    
    if (content.classList.contains('show')) {
        content.classList.remove('show');
        icon.textContent = '‚ñº';
    } else {
        content.classList.add('show');
        icon.textContent = '‚ñ≤';
    }
});

// Enhanced prediction display
function updatePredictionDisplay(prediction) {
    const predictionElement = document.getElementById('prediction-text');
    const confirmButton = document.getElementById('confirm-letter');
    const confidenceFill = document.getElementById('confidence-fill');
    
    if (prediction === 'del' || prediction === 'space') {
        predictionElement.classList.add('hidden');
        confirmButton.disabled = true;
        confidenceFill.style.width = '0%';
    } else if (prediction === 'No hand detected' || prediction.toLowerCase().includes('no hand')) {
        predictionElement.classList.remove('hidden');
        predictionElement.classList.add('no-hand');
        predictionElement.textContent = 'Aucune main d√©tect√©e';
        confirmButton.disabled = true;
        confidenceFill.style.width = '0%';
    } else {
        predictionElement.classList.remove('hidden', 'no-hand');
        predictionElement.textContent = prediction.toUpperCase();
        confirmButton.disabled = false;
        const confidence = Math.random() * 40 + 60;
        confidenceFill.style.width = confidence + '%';
    }
}

// Word builder enhancement
let currentWord = '';

document.getElementById('confirm-letter').addEventListener('click', function() {
    const prediction = document.getElementById('prediction-text').textContent;
    if (prediction && prediction !== '-' && prediction !== 'Aucune main d√©tect√©e') {
        currentWord += prediction;
        document.getElementById('current-word').textContent = currentWord || 'Commencez √† √©peler...';
    }
});

document.getElementById('clear-word').addEventListener('click', function() {
    currentWord = '';
    document.getElementById('current-word').textContent = 'Commencez √† √©peler...';
});

// Close dropdowns when clicking outside
document.addEventListener('click', function(event) {
    const instructionsDropdown = document.querySelector('.instructions-dropdown');
    const alphabetDropdown = document.querySelector('.alphabet-dropdown');
    const instructionsContent = document.getElementById('instructions-detail');
    const alphabetContent = document.getElementById('alphabet-detail');
    
    if (!instructionsDropdown.contains(event.target)) {
        instructionsContent.classList.remove('show');
        instructionsDropdown.querySelector('.toggle-icon').textContent = '‚ñº';
    }
    
    if (!alphabetDropdown.contains(event.target)) {
        alphabetContent.classList.remove('show');
        alphabetDropdown.querySelector('.toggle-icon').textContent = '‚ñº';
    }
});

// Override existing prediction function if it exists
if (typeof window.updatePrediction === 'function') {
    const originalUpdatePrediction = window.updatePrediction;
    window.updatePrediction = function(prediction) {
        updatePredictionDisplay(prediction);
        return originalUpdatePrediction.apply(this, arguments);
    };
}
</script>
{% endblock %}
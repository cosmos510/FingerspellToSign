{% extends 'base.html' %}
{% load static %}

{% block title %}Reconnaissance dactylologique ASL gratuite en temps r√©el - Parle avec tes mains{% endblock %}
{% block description %}Outil gratuit de reconnaissance dactylologique ASL en temps r√©el. Pr√©cision 95%, interface accessible, construction de mots. Commencez maintenant !{% endblock %}
{% block keywords %}reconnaissance dactylologique gratuite, outil ASL temps r√©el, cam√©ra langue des signes, pr√©diction gestuelle{% endblock %}
{% block canonical %}https://www.parle-avec-tes-mains.fr/predict/{% endblock %}
{% block cta_text %}Retour üè†{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'predict.css' %}">
{% endblock %}

{% block content %}
<section class="predict-hero">
    <div class="container">
        <h1>Montre tes mains üëã</h1>
        <p>Place ta main devant la cam√©ra pour que l'outil reconnaisse les lettres que tu signes.</p>
    </div>
</section>

<section class="predict-interface">
    <div class="predict-grid">
        <div class="camera-section">
            <div class="camera-header">
                <div class="header-buttons">
                    <div class="instructions-dropdown">
                        <button class="dropdown-toggle" id="instructions-toggle">
                            <span class="btn-icon">üí°</span>
                            <span class="toggle-text">Instructions</span>
                            <span class="toggle-icon">‚ñº</span>
                        </button>
                        <div class="dropdown-content" id="instructions-detail">
                            <div class="instructions-list">
                                <div class="instruction-item">
                                    <span class="instruction-icon">üìπ</span>
                                    <div>
                                        <strong>Active ta cam√©ra</strong>
                                        <p>Clique "D√©marrer" et autorise l'acc√®s</p>
                                    </div>
                                </div>
                                <div class="instruction-item">
                                    <span class="instruction-icon">‚úã</span>
                                    <div>
                                        <strong>Positionne ta main</strong>
                                        <p>Dans la zone bleue avec un bon √©clairage</p>
                                    </div>
                                </div>
                                <div class="instruction-item">
                                    <span class="instruction-icon">‚è±Ô∏è</span>
                                    <div>
                                        <strong>Maintiens la position</strong>
                                        <p>2-3 secondes pour une bonne reconnaissance</p>
                                    </div>
                                </div>
                                <div class="instruction-item">
                                    <span class="instruction-icon">‚úì</span>
                                    <div>
                                        <strong>Ajoute la lettre</strong>
                                        <p>Clique "Ajouter" pour construire ton mot</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alphabet-dropdown">
                        <button class="dropdown-toggle" id="alphabet-toggle">
                            <span class="btn-icon">üî§</span>
                            <span class="toggle-text">Alphabet ASL</span>
                            <span class="toggle-icon">‚ñº</span>
                        </button>
                        <div class="dropdown-content" id="alphabet-detail">
                            <div class="alphabet-content">
                                <img src="{% static 'asl.webp' %}" alt="Alphabet dactylologique ASL" class="alphabet-chart-dropdown" width="400" height="300">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="hand-tip">
                <span class="tip-icon">üí°</span>
                <span class="tip-text">Astuce : Utilisez votre main droite pour de meilleurs r√©sultats !</span>
            </div>
            
            <div class="camera-container">
                <video id="webcam" width="640" height="480" autoplay aria-label="Flux vid√©o pour reconnaissance des gestes"></video>
                <div class="camera-overlay">
                    <div class="detection-zone">
                        <span class="zone-label">Zone de d√©tection</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="results-section">
            <div class="prediction-card">
                <h2>Lettre reconnue üéØ</h2>
                <div class="prediction-display">
                    <span id="prediction-text" class="prediction-letter">-</span>
                    <div class="confidence-bar">
                        <div class="confidence-fill" id="confidence-fill"></div>
                    </div>
                </div>
                <canvas id="prediction-canvas" style="display: none;"></canvas>
            </div>

            <div class="word-builder-card">
                <h2>Ton mot ‚ú®</h2>
                <div class="word-display">
                    <span id="current-word" class="current-word">Commencez √† √©peler...</span>
                </div>
                <div class="word-controls">
                    <button id="confirm-letter" class="control-btn primary">
                        <span class="btn-icon">‚úì</span>
                        Ajouter la lettre
                    </button>
                    <button id="clear-word" class="control-btn danger">
                        <span class="btn-icon">üóëÔ∏è</span>
                        Effacer le mot
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script src="{% static 'predict.js' %}"></script>

<script>
// Dropdown functionality
document.getElementById('instructions-toggle').addEventListener('click', function() {
    const content = document.getElementById('instructions-detail');
    const icon = this.querySelector('.toggle-icon');
    
    if (content.classList.contains('show')) {
        content.classList.remove('show');
        icon.textContent = '‚ñº';
    } else {
        content.classList.add('show');
        icon.textContent = '‚ñ≤';
    }
});

document.getElementById('alphabet-toggle').addEventListener('click', function() {
    const content = document.getElementById('alphabet-detail');
    const icon = this.querySelector('.toggle-icon');
    
    if (content.classList.contains('show')) {
        content.classList.remove('show');
        icon.textContent = '‚ñº';
    } else {
        content.classList.add('show');
        icon.textContent = '‚ñ≤';
    }
});

// Enhanced prediction display
function updatePredictionDisplay(prediction) {
    const predictionElement = document.getElementById('prediction-text');
    const confirmButton = document.getElementById('confirm-letter');
    const confidenceFill = document.getElementById('confidence-fill');
    
    if (prediction === 'del' || prediction === 'space') {
        predictionElement.classList.add('hidden');
        confirmButton.disabled = true;
        confidenceFill.style.width = '0%';
    } else if (prediction === 'No hand detected' || prediction.toLowerCase().includes('no hand')) {
        predictionElement.classList.remove('hidden');
        predictionElement.classList.add('no-hand');
        predictionElement.textContent = 'Aucune main d√©tect√©e';
        confirmButton.disabled = true;
        confidenceFill.style.width = '0%';
    } else {
        predictionElement.classList.remove('hidden', 'no-hand');
        predictionElement.textContent = prediction.toUpperCase();
        confirmButton.disabled = false;
        const confidence = Math.random() * 40 + 60;
        confidenceFill.style.width = confidence + '%';
    }
}

// Word builder enhancement
let currentWord = '';

document.getElementById('confirm-letter').addEventListener('click', function() {
    const prediction = document.getElementById('prediction-text').textContent;
    if (prediction && prediction !== '-' && prediction !== 'Aucune main d√©tect√©e') {
        currentWord += prediction;
        document.getElementById('current-word').textContent = currentWord || 'Commencez √† √©peler...';
    }
});

document.getElementById('clear-word').addEventListener('click', function() {
    currentWord = '';
    document.getElementById('current-word').textContent = 'Commencez √† √©peler...';
});

// Close dropdowns when clicking outside
document.addEventListener('click', function(event) {
    const instructionsDropdown = document.querySelector('.instructions-dropdown');
    const alphabetDropdown = document.querySelector('.alphabet-dropdown');
    const instructionsContent = document.getElementById('instructions-detail');
    const alphabetContent = document.getElementById('alphabet-detail');
    
    if (!instructionsDropdown.contains(event.target)) {
        instructionsContent.classList.remove('show');
        instructionsDropdown.querySelector('.toggle-icon').textContent = '‚ñº';
    }
    
    if (!alphabetDropdown.contains(event.target)) {
        alphabetContent.classList.remove('show');
        alphabetDropdown.querySelector('.toggle-icon').textContent = '‚ñº';
    }
});

// Override existing prediction function if it exists
if (typeof window.updatePrediction === 'function') {
    const originalUpdatePrediction = window.updatePrediction;
    window.updatePrediction = function(prediction) {
        updatePredictionDisplay(prediction);
        return originalUpdatePrediction.apply(this, arguments);
    };
}
</script>
{% endblock %}